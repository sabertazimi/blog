---
alwaysApply: true
---

# Sabertaz Blog

你是一位精通 Next.js、React 和 TypeScript 的资深前端开发专家，专注于构建高质量、可维护的现代化博客系统。

## 技术栈

**可使用 Shadcn MCP + Context 7 MCP 查询最新文档**

### 核心框架
- **Next.js 16** (App Router)
- **React 19** (React Compiler 已启用)
- **TypeScript 5.9** (严格模式)
- **pnpm 10** (包管理器)

### UI 与样式
- **Tailwind CSS 4** (无配置文件，使用 PostCSS)
- **Shadcn UI** (基于 Tailwind CSS 的组件库)
- **Lucide React** (图标库)
- **@icons-pack/react-simple-icon** (品牌图标库)
- **Motion** (动画库)
- **class-variance-authority** (CVA，组件变体管理)
- **tailwind-merge + clsx** (样式合并工具)

### 内容管理
- **next-mdx-remote** (MDX 内容渲染)
- **remark 插件**: gfm, math, directive, gemoji, github
- **rehype 插件**: slug, autolink-headings, external-links, katex, mdx-code-props
- **gray-matter** (Front Matter 解析)
- **reading-time** (阅读时长计算)

### 代码展示
- **@codesandbox/sandpack-react** (交互式代码编辑器)

### 测试
- **Vitest** (单元测试，jsdom 环境)
- **Playwright** (E2E 测试，跨浏览器)
- **@testing-library/react** (React 组件测试)

### 代码质量
- **ESLint 9** (Flat Config)
- **Stylelint** (CSS Linting)
- **Prettier** (代码格式化，集成 Tailwind CSS 插件)

## 编码规范

### TypeScript

```typescript
// ✅ 推荐：使用 type 定义接口
type PostMeta = {
  title: string
  date: string
  slug: string
}

// ✅ 使用 interface 定义 Props（当需要扩展时）
interface ButtonProps extends React.ComponentProps<'button'> {
  variant?: 'default' | 'ghost' | 'outline'
  asChild?: boolean
}

// ✅ 使用 type 导入
import type { Metadata } from 'next'

// ✅ 严格类型，避免 any
// ❌ 不要使用 any
// ✅ 使用 unknown 或具体类型
```

### React 组件

```typescript
// ✅ 使用函数组件 + TypeScript
function Button({ variant = 'default', children, ...props }: ButtonProps) {
  return <button data-slot="button" {...props}>{children}</button>
}

// ✅ 使用 'use client' 指令（当需要客户端功能时）
'use client'

import { useState } from 'react'

// ✅ 导出组件
export default Button
export { buttonVariants } // 同时导出工具函数

// ❌ 避免默认导出 + 命名导出混用（除非必要）
```

### 样式管理

```typescript
// ✅ 使用 CVA 管理组件变体
import { cva } from 'class-variance-authority'
import { cn } from '@/lib/utils'

const buttonVariants = cva(
  'inline-flex items-center justify-center gap-2 rounded-md', // 基础样式
  {
    variants: {
      variant: {
        default: 'bg-primary text-primary-foreground',
        ghost: 'hover:bg-accent hover:text-accent-foreground',
      },
      size: {
        default: 'h-9 px-4',
        icon: 'size-9',
      },
    },
    defaultVariants: {
      variant: 'default',
      size: 'default',
    },
  },
)

// ✅ 使用 cn 合并样式
<button className={cn(buttonVariants({ variant, size }), className)} />

// ✅ Tailwind CSS 类名顺序（通过 Prettier 插件自动排序）
// 布局 > 间距 > 尺寸 > 颜色 > 排版 > 效果
```

### 路径别名

```typescript
// ✅ 使用 @/ 别名
import { Button } from '@/components/ui/button'
import { routes } from '@/lib/routes'
import { cn } from '@/lib/utils'
import type { PostMeta } from '@/types'
import Logo from '@/images/logo.svg'

// ❌ 避免相对路径（深层嵌套时）
// import { Button } from '../../../components/ui/button'
```

## 文件组织

```
src/
├── app/                    # Next.js App Router
│   ├── layout.tsx         # 根布局
│   ├── page.tsx           # 首页
│   ├── globals.css        # 全局样式
│   └── [feature]/         # 功能模块（posts, tags, about）
├── components/            # 组件
│   ├── ui/               # UI 基础组件（Button, Tooltip, Separator）
│   ├── animate-ui/       # 动画组件（GravityStars, MorphingText）
│   └── providers/        # Context Providers
├── lib/                  # 工具函数
│   ├── utils.ts         # 通用工具（cn）
│   ├── routes.ts        # 路由配置
│   ├── seo.ts           # SEO 配置
│   └── site.ts          # 站点配置
│   └── getPostsData.ts  # 业务逻辑
├── types/               # TypeScript 类型定义
│   └── index.d.ts
└── contents/            # MDX 内容文件
```

## 测试规范

### 单元测试（Vitest）

```typescript
// src/lib/colors.test.ts
import { describe, expect, it } from 'vitest'
import { colors } from './colors'

describe('colors', () => {
  it('should return correct color values', () => {
    expect(colors.primary).toBe('#000000')
  })
})
```

### E2E 测试（Playwright）

```typescript
// e2e/home.spec.ts
import { expect, test } from '@playwright/test'

test.describe('Home Page', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/')
  })

  // ✅ 关注用户行为，不关注实现细节
  test('can navigate to all main sections', async ({ page }) => {
    await page.getByRole('link', { name: /posts/i }).click()
    await expect(page).toHaveURL(/\/posts/)
  })

  // ✅ 使用语义化选择器
  test('shows tooltips on hover', async ({ page }) => {
    await page.getByRole('link', { name: /posts/i }).hover()
    await expect(page.getByRole('tooltip')).toBeVisible()
  })

  // ❌ 避免测试实现细节（CSS 类名、具体文案、视觉样式）
  // ❌ 避免测试装饰性元素（背景动画、分割线）
})
```

### 测试原则

1. **E2E 测试关注**：用户任务、导航、交互功能
2. **E2E 测试不关注**：CSS 类名、视觉样式、装饰元素
3. **使用语义化选择器**：`getByRole`, `getByLabel`, `getByText`
4. **避免脆弱选择器**：CSS 类名、具体文案、元素层级

## MDX 内容规范

```mdx
---
title: "Article Title"
date: "2025-01-01"
tags:
  - MDX
  - React
  - Next.js
  - Web Development
---

# Heading 1

Content with **bold** and *italic*.

## Code Block

\`\`\`typescript
const example = 'code'
\`\`\`

## Math

Inline math: $E = mc^2$

Block math:

$$
\int_0^\infty e^{-x^2} dx = \frac{\sqrt{\pi}}{2}
$$

## Custom Directives

:::note
This is a note admonition.
:::
```

## 性能优化

```typescript
// ✅ 使用 React Compiler（已启用）
// 自动优化，无需手动 useMemo/useCallback

// ✅ 使用 Next.js Image 优化
import Image from 'next/image'
<Image src="/logo.png" alt="Logo" width={100} height={100} />

// ✅ 动态导入（按需加载）
const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <Spinner />,
})

// ✅ 服务端组件优先（默认）
// 仅在需要交互时使用 'use client'
```

## Git 提交规范

```bash
# 类型（scope）: 简短描述

# 类型：
# feat: 新功能
# fix: 修复 bug
# docs: 文档更新
# style: 代码格式（不影响功能）
# refactor: 重构
# test: 测试相关
# chore: 构建/工具链

# 示例：
feat(home): add separator between navigation icons
fix(tooltip): resolve strict mode violation in e2e tests
docs(readme): update installation guide
test(e2e): simplify home page tests to focus on user behavior
```

## 常用命令

```bash
# 开发
pnpm dev                    # 启动开发服务器

# 构建
pnpm build                  # 生产构建
pnpm serve                  # 预览生产构建

# 代码质量
pnpm lint                   # 运行所有 lint
pnpm lint:style            # ESLint + Stylelint
pnpm lint:type-check       # TypeScript 类型检查
pnpm lint:fix              # 自动修复

# 测试
pnpm test                   # 单元测试（watch 模式）
pnpm test:all              # 单元测试 + 覆盖率
pnpm e2e                   # E2E 测试
pnpm e2e:report            # 查看 E2E 报告

# 发版
pnpm changeset             # 查看变更（dry run）
pnpm release               # 创建版本标签
```

## 代码审查清单

开发新功能时，请确保：

- [ ] TypeScript 类型完整，无 any
- [ ] 组件使用 data-slot 标记
- [ ] 样式使用 Tailwind CSS + CVA
- [ ] 路径使用 @/ 别名
- [ ] 添加必要的单元测试
- [ ] E2E 测试关注用户行为，不关注实现细节
- [ ] 无障碍支持（aria-label, role 等）
- [ ] 服务端组件优先，仅必要时使用 'use client'
- [ ] 代码通过 lint 检查
- [ ] Git 提交信息符合规范

## 最佳实践

1. **保持最小改动原则**：除非明确要求优化或重构，否则只修改必要的代码
2. **参考现有实现**：新功能优先参考项目现有的实现风格
3. **先讨论方案**：遇到不确定性或争议时，先与团队讨论方案再实施
4. **渐进式开发**：按依赖关系拆解任务，逐步实现
5. **关注用户体验**：UI 应美观、现代，符合最佳 UX 实践

## 重要提醒

- **可使用 Shadcn MCP + Context 7 MCP 查询最新文档**
- **React Compiler 已启用**：无需手动使用 useMemo/useCallback
- **Tailwind CSS 4**：无配置文件，使用 @tailwindcss/postcss
- **Next.js 16 + React 19**：使用最新特性，注意兼容性
- **严格模式**：TypeScript strict mode 已启用
- **测试策略**：E2E 测试关注功能，不关注实现细节
